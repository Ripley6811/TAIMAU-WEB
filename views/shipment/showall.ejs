<!--List view of all shipments-->
<div class='container-fluid'>
<!--START: Company navigation header-->
    <div class="row text-center">
        <div class="col-md-4 h1 text-center">
            <div class="row">
                <strong data-bind="text: co_name"></strong>
                <font color="lightgrey">(公司)</font>
            </div>
            <div class="row">
                <form action="/cogroup/toggle" method="post"><input type="hidden" name="_csrf" value="<%= _csrf %>" />
                    <input type="hidden" name="cogroup" value="<%= cogroup.name %>">
                    <input type="hidden" name="back" value="/cogroup/show/<%= cogroup.name %>">
                    <div class="btn-group btn-group-lg">
                        <button data-bind="click: cogroup.toggleSupplier, attr: {'class': cogroup.supplierStatus}"> 供應商</button>
                        <button data-bind="click: cogroup.toggleCustomer, attr: {'class': cogroup.customerStatus}"> 客戶</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-8">
            <div>
                <div class="btn-group btn-group-lg btn-group-justified hidden-xs">
                    <a href="/cogroup/show/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-info-sign"></i> <strong>公司與產品訊息</strong></a>
                    <a href="/order/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-pencil"></i> <strong>創造一個訂單</strong></a>
                    <a href="/order/showall/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-folder-open"></i> <strong>管理訂單與到期日</strong></a>
                </div>
                <div class="btn-group btn-group-lg btn-group-justified hidden-xs">
                    <a href="/shipment/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-shopping-cart"></i> <strong>創造出貨單</strong></a>
                    <a disabled href="/invoice/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-usd"></i> <strong>創造發票</strong></a>
                    <a disabled href="/shipment/showall/<%= cogroup.name %>" class="active btn btn-custom"><i class="glyphicon glyphicon-piggy-bank"></i> <strong>管理出貨單與發票</strong></a>
                </div>
            </div>
        </div>
    </div>
<!--END: Company navigation header-->
<hr>
<!--START: List view of shipments-->
<div style="list-style-type:none" data-bind="foreach: shipments">
        <div class="panel panel-success">
            <div class="panel-heading" style="padding: 0px" data-bind="click: toggleDisplay">
                <span class="h4" style="margin: 0px" data-bind="text: shipmentdate"></span>
                <span class="h4" style="margin: 0px" data-bind="text: shipment_no"></span>
            </div>
            <div class="panel-body" style="padding: 0px" data-bind="visible: displayItems">
                <table>
                    <thead>
                        <th>ORDER</th>
                        <th>QTY</th>
                    </thead>
                    <tbody data-bind="foreach: items">
                        <tr>
                            <td><span data-bind="text: order_id"></span></td>
                            <td><span data-bind="text: qty"></span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

</div>

    
<!--END: List view of shipments-->
</div><!--END: container-fluid-->


<script>
var cogroup = <%- JSON.stringify(cogroup) %>;
var co_name = '<%= cogroup.name %>';
addCompanyNavButtons(co_name);
var _csrf = '<%= _csrf %>';
    
function PageModel() {
    var self = this;
    
    /**
     * COGROUP section controls
     * 
     * 
     */
    self.cogroup = new KO_Cogroup(cogroup);
    
    self.supplierStatus = ko.computed(function () {
        return self.cogroup.is_supplier() === true ? "glyphicon glyphicon-ok btn btn-success" : "glyphicon glyphicon-remove btn btn-danger";
    });
    
    self.customerStatus = ko.computed(function () {
        return self.cogroup.is_customer() === true ? "glyphicon glyphicon-ok btn btn-success" : "glyphicon glyphicon-remove btn btn-danger";
    });
    
    self.toggleCustomer = function () {
        self.cogroup.is_customer(!self.cogroup.is_customer());
        self.cogroupUpdate();
    };
    self.toggleSupplier = function () {
        self.cogroup.is_supplier(!self.cogroup.is_supplier());
        self.cogroupUpdate();
    };
                
    self.cogroupUpdate = function () {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState !== 4) return;
            
        };
        xmlhttp.open('POST', '/cogroup/update', true);
        xmlhttp.setRequestHeader('Content-type', 'application/json');
        xmlhttp.send(ko.toJSON({
            _csrf: _csrf, 
            cogroup_update: self.cogroup
        }));
    };
    
    
    /**
     * SHIPMENT methods
     * 
     * 
     */
    self.shipments = ko.observableArray();
    self.shipmentsGet = function () {
        params = {
            _csrf: _csrf, 
            id: co_name,
            limit: 10,
        };
        callback = function (shipments) {
//            alert(JSON.stringify(shipments, null, '   '));
            self.shipments.removeAll();
            for (var i=0; i<shipments.length; i++) {
                if (!shipments[i].discontinued) {
                    self.shipments.push(new KO_Shipment(shipments[i]));
                }
            }
        };
        getShipments(params, callback);
    };
    self.shipmentsGet();
    
    
    
    
    var getShipmentsProcess = function () {
        getTemplate(
            '/database/get/shipments', 
            {
                _csrf: _csrf, 
            }, 
            function (res_records) {
                
            }
        );
    };
    getShipmentsProcess()
}

ko.applyBindings(new PageModel());
</script>