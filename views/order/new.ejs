<!--Table view of all products for a single company-->

<div id="thisPage" class="container-fluid">
    
    
<!--START: Main row for two-panes-->
<div class="row">   
    <div class="col-md-8 col-md-push-4">
<!--vvv START: Company header and buttons vvv-->
    <div class="row text-center">
        <div class="col-md-4 h2 text-center" style="margin: 0px; padding: 0px 0px">
            <div class="row">
                <strong data-bind="text: co_name"></strong>
                <font color="lightgrey">(公司)</font>
            </div>
            <div class="row">
                <form action="/cogroup/toggle" method="post"><input type="hidden" name="_csrf" value="<%= _csrf %>" />
                    <input type="hidden" name="cogroup" value="<%= cogroup.name %>">
                    <input type="hidden" name="back" value="/cogroup/show/<%= cogroup.name %>">
                    <div class="btn-group">
                        <button data-bind="click: cogroup.toggleSupplier, attr: {'class': cogroup.supplierStatus}"> 供應商</button>
                        <button data-bind="click: cogroup.toggleCustomer, attr: {'class': cogroup.customerStatus}"> 客戶</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-8" style="margin: 0px; padding: 0px 5px">
            <div>
                <div class="btn-group btn-group-justified hidden-xs">
                    <a href="/cogroup/show/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-info-sign"></i> <strong>公司與產品訊息</strong></a>
                    <a href="/order/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-pencil"></i> <strong>創造一個訂單</strong></a>
                    <a href="/order/showall/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-folder-open"></i> <strong>管理訂單與到期日</strong></a>
                </div>
                <div class="btn-group btn-group-justified hidden-xs">
                    <a href="/shipment/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-shopping-cart"></i> <strong>創造出貨單</strong></a>
                    <a href="/invoice/new/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-usd"></i> <strong>創造發票</strong></a>
                    <a href="/shipment/showall/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-piggy-bank"></i> <strong>管理出貨單與發票</strong></a>
                </div>
            </div>
        </div>
    </div>
<!--^^^ END: Company header and buttons ^^^-->
	<hr>
<!--START: PO entry form-->
    <form action="/order/create">
        <input type="hidden" name="_csrf" value="<%= _csrf %>" />
        <input type="hidden" name="group" value="<%= cogroup.name %>" />
    
    <div class="row-fluid h2">
        <strong>訂單</strong>
    </div>
    <div class="row-fluid">
        <div class="col-md-5">
            <div class="form-group form-group-lg">
                <label class="control-label">訂單編號</label>
                <div class="has-success">
                    <input type="text" class="form-control" name="orderID" data-bind="value: orderID">
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group form-group-lg">
                <label class="control-label">訂單日期</label>
                <div class="has-success">
                    <input type="date" class="form-control" name="orderdate" required>
                </div>
            </div>
        </div>
    </div>
    
<table class="table table-condensed table-striped hidden-lg">
    <thead class="text-uppercase">
        <tr>
        <th>標籤品名 / 價格</th>
        <th class="text-center">數量 / 總價值</th>
        <th>備註</th>
    </tr></thead>
    <tbody data-bind="foreach: rows">
        <tr>            
<!--        Product label    -->
            <input type="hidden" name="MPN" data-bind="value: MPN">
            <input type="hidden" name="is_supply" data-bind="value: is_supply">
            <td style="width:30%">
                <span class="text-left" data-bind="text: label"></span>
                <br>
            
<!--        Price    -->
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-right" name="price" data-bind="textInput: price" required />
                    <div class="input-group-addon" data-bind="text: pricing"></div>
                </div>
            </td>
            
<!--        Quantities    -->
            <td style="width:15%">
                <div class="input-group has-success">
                <input style="font-size: 18px;" type="number" min=1 max=100000 class="form-control text-right" name="qty" data-bind="textInput: qty" required />
                <div class="input-group-addon" data-bind="text: jianshu"></div>
                </div>
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input disabled style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-left total-value" data-bind="value: total_value">
                </div>
            </td>
                        
<!--        Notes    -->
            <td style="width:20%">
                <textarea rows="2" type="text" style="width: 100%" class="form-control" name="ordernote"></textarea>
            </td>
            
        </tr>
        </tbody>
</table>
        
<table class="table table-condensed table-striped hidden-xs hidden-sm hidden-md">
    <thead class="text-uppercase">
        <tr>
        <th>標籤品名</th>
        <th class="text-center">價格</th>
        <th class="text-center">數量</th>
        <th class="text-center">總價值</th>
        <th>備註</th>
    </tr></thead>
    <tbody data-bind="foreach: rows">
        <tr>            
<!--        Product label    -->
            <input type="hidden" name="MPN" data-bind="value: MPN">
            <input type="hidden" name="is_supply" data-bind="value: is_supply">
            <td style="width: 15%">
                <span class="text-left" data-bind="text: label"></span>
            </td>
            
<!--        Price    -->
            <td style="width:20%">
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-right" name="price" data-bind="textInput: price" required />
                    <div class="input-group-addon" data-bind="text: pricing"></div>
                </div>
            </td>
            
<!--        Quantities    -->
            <td style="width:15%">
                <div class="input-group has-success">
                <input style="font-size: 18px;" type="number" min=1 max=100000 class="form-control text-right" name="qty" data-bind="textInput: qty" required />
                <div class="input-group-addon" data-bind="text: jianshu"></div>
                </div>
            </td>
            
<!--        Total value    -->
            <td style="width:15%">
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input disabled style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-left total-value" data-bind="value: total_value">
                </div>
            </td>
                        
<!--        Notes    -->
            <td style="width:20%">
                <input type="text" style="width: 100%" class="form-control" name="ordernote">
            </td>
            
        </tr>
        </tbody>
</table>
        
    <div class="row">
        <div class="col-md-4 col-md-offset-1">
            
            <input type="hidden" name="back" value="/product/show/<%= cogroup.name %>">
            <input type="submit" class="btn btn-lg btn-success" name="make_po" value="創造訂單">
            
        </div>
        
        <div class="col-md-5 form-group form-group-lg form-inline">
            <label class="control-label">訂單總價</label>
            <div class="input-group has-success">
                <div class="input-group-addon">$</div>
                <input disabled style="font-size: 18px; width: 50%" type="text" class="form-control text-left" data-bind="value: grand_total()">
            </div>
        </div>
    </div>
        </form>
<!--END: PO entry form-->
    </div>
    <div class="col-md-4 col-md-pull-8" style="padding: 0px">
<!--vvv START: Panel for products and services list vvv-->
        <div class="panel panel-success">
            <div class="panel-heading">
                <h3 class="panel-title text-center">
                    <strong>產品 / 服務</strong>
                </h3>
            </div>
            <div class="panel-body" style="padding: 0px; overflow-y:scroll; height:75vh;">
                <table class="table table-condensed table-striped">
                    <thead class="text-uppercase">
                        <tr>
                            <th>選</th>
                            <th>
                                品名
                                <span class="label label-primary">備註</span>
                                <span class="badge">標籤</span>
                                <span class="label label-success">英文</span>
                            </th>
                            <th>
                                容量 - 容器
                            </th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: products">
                        <tr>            
                <!--        Product Manifest selection    -->
                            <td style="width: 40px">
                                <input style="width:36px; height:36px;" type="checkbox" name="product" data-bind="checked: selected">
                            </td>

                <!--        Product inventory name    -->
                            <td>
                                <span data-bind="text: inventory_name"></span> <span class="label label-primary" data-bind="text: note"></span>
                                <br>
                                <label class="badge" data-bind="text: product_label"></label>
                                <span style="white-space: normal;" class="label label-success" data-bind="text: english_name"></span>
                            </td>
                            <td style="width: 25%">
                                <span data-bind="text: units() + ' ' + UM()"></span> - <span data-bind="text: SKU"></span>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="panel-footer">
                <div class="text-center">
                    已停用的產品藏起來了. 看公司訊息.
                </div>
            </div>
        </div>
<!--^^^ END: Panel for products and services list ^^^-->
    </div>
</div>
    
        
        
    


</div>


    
    
    
    
<script>
var cogroup = new KO_Cogroup(<%- JSON.stringify(cogroup) %>);
var co_name = '<%= cogroup.name %>';
addCompanyNavButtons(co_name);
var _csrf = '<%= _csrf %>';
    
function ItemsModel() {
    var self = this;
    
    
    
    
    
    self.orderID = ko.observable();
    
    self.products = ko.observableArray([]);
    self.productsGet = function () {
        params = {
            _csrf: _csrf, 
            id: co_name,
        };
        callback = function (products) {
            self.products.removeAll();
            for (var i=0; i<products.length; i++) {
                if (!products[i].discontinued) {
                    self.products.push(new KO_Product(products[i]));
                }
            }
        };
        getProducts(params, callback);
    };
    self.productsGet();
    
    self.rows = ko.observableArray([]);
    
    self.grand_total = ko.computed( function () {
        var total = 0;
        for (var i=0; i<self.rows().length; i++) {
            total += self.rows()[i].total_value();
        }
        return isNaN(total) ? '' : total;
    });
    
    for (var i=0; i<self.products.length; i=i+1) {
        self.rows.push(new KO_PurchaseOrder(self.products[i], self.orderID));
    }
    
    var selectCompute = ko.computed(function () {
        self.rows.removeAll()
        for (var i=0; i<self.products().length; i++) {
            if (self.products()[i].selected()) {
                self.rows.push(new KO_PurchaseOrder(ko.toJS(self.products()[i]), self.orderID));
            }
        }
    });
}

ko.applyBindings(new ItemsModel(), document.getElementById("thisPage"));

</script>