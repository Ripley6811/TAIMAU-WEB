<!--Table view of all products for a single company-->

<div class="container-fluid">
    <div class="row">
        <div class="col-md-4 h1 text-center">
            <div class="row">
            <strong><%= cogroup.name %></strong><font color="lightgrey">(公司)</font>
            </div>
            <div class="row">
                <form action="/cogroup/toggle" method="post"><input type="hidden" name="_csrf" value="<%= _csrf %>" />
                    <input type="hidden" name="cogroup" value="<%= cogroup.name %>">
                    <input type="hidden" name="back" value="/product/show/<%= cogroup.name %>">
                    <div class="btn-group">
                    <button type="submit" name="toggle" value="supplier" class=
                                    <% if (cogroup.is_supplier) { %>
                                    "glyphicon glyphicon-ok btn btn-success"
                                    <% } else { %>
                                    "glyphicon glyphicon-remove btn btn-danger"
                                    <% } %>
                        > 供應商</button>
                    <button type="submit" name="toggle" value="customer" class=
                                    <% if (cogroup.is_customer) { %>
                                    "glyphicon glyphicon-ok btn btn-success"
                                    <% } else { %>
                                    "glyphicon glyphicon-remove btn btn-danger"
                                    <% } %>
                        > 客戶</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-8 text-center">
            <div class="btn-group-vertical">
                <a href="/cogroup/show/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-info-sign"></i> <strong>公司,聯絡人,產品信息</strong></a>
                <a href="/product/show/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-pencil"></i> <strong>管理使用中訂單,創造出貨單</strong></a>
                <a href="/order/showall/<%= cogroup.name %>" class="btn btn-custom"><i class="glyphicon glyphicon-folder-open"></i> <strong>全部訂單歷史</strong></a>
            </div>
        </div>
    </div>
    
    
    
    
	<hr>
    
<!--CREATE A PO LIST-->
    
<div class="row">
    <div class="col-md-4" style="overflow-y:scroll; height:70vh;">
    
    
        <div class="row-fluid">
            <h2 class="col-md-12">產品/服務</h2>
        </div>
    
<table class="table table-condensed">
    <thead class="text-uppercase"><tr>
<!--        <th></th>-->
        <th>選</th>
        <th>品名</th>
        <th class="text-center">
            <abbr title="桶, 包, 瓶, 等...">容器</abbr>
        </th>
        <th class="text-center">
            <abbr title="# of kg, L, gal per container">容量</abbr>
            <abbr title="kg, L, gal, etc.">單位</abbr>
        </th>
        <th>備註</th>
    </tr></thead>
    <tbody data-bind="foreach: products">
        <tr>
<!--
            <td>
                <span class="badge" data-bind="visible: is_supply()">
                    <abbr title="買:We buy"><span class="glyphicon glyphicon-arrow-right"></span></abbr>
                    <span class="glyphicon glyphicon-home"></span>
                    <span class="glyphicon glyphicon-none"></span>
                </span>
                
                <span class="badge" data-bind="visible: !is_supply()">
                    <span class="glyphicon glyphicon-none"></span>
                    <span class="glyphicon glyphicon-home"></span>
                    <abbr title="賣:We sell"><span class="glyphicon glyphicon-arrow-right"></span></abbr>
                </span>
            </td>
-->
            
<!--        Product Manifest selection    -->
            <td>
                <input style="width:26px; height:26px;" type="checkbox" name="product" data-bind="checked: selected">
            </td>
            
            
<!--        Product inventory name    -->
            <td>
                <span data-bind="text: inventory_name"></span>
                <br>
                <label class="label label-success" data-bind="text: product_label"></label>
                <br>
                <span style="white-space: normal;" class="label label-primary" data-bind="text: english_name"></span>
            </td>
            <td class="text-center">
                <span data-bind="text: SKU, visible: locked()"></span>
                <input size="4" placeholder="槽車,桶,包,..." data-bind="textInput: SKU, visible: !locked()">
                <br>
                <span class="badge" data-bind="visible: !unitpriced() && locked()"><abbr title="Priced by container" class="glyphicon glyphicon-usd"></abbr></span>
            </td>
            <td class="text-center">
                <span data-bind="text: units, visible: locked()"></span>
                <input size="2" placeholder="#" data-bind="textInput: units, visible: !locked()">
                <span data-bind="text: UM, visible: locked()"></span>
                <input size="3" placeholder="kg, L, ..." data-bind="textInput: UM, visible: !locked()">
                <br>
                <span data-bind="visible: unitpriced() && locked()" class="badge"><abbr title="Priced by unit" class="glyphicon glyphicon-usd"></abbr></span>
            </td>
            <td>
                <span data-bind="text: note"></span>
            </td>
            
        </tr>
        </tbody>
</table>
    
    
        <div class="row">
            <div class="col-md-6 input-24 text-right">
                <span class="label label-warning">已停用的產品藏起來了. 看公司訊息.</span>
            </div>
        </div>
    </div>
    
    
    
    
    <div class="col-md-8">
    
    
    <form action="/order/create">
        <input type="hidden" name="_csrf" value="<%= _csrf %>" />
        <input type="hidden" name="group" value="<%= cogroup.name %>" />
    
    <div class="row-fluid h2">
        <strong>訂單</strong>
    </div>
    <div class="row-fluid">
        <div class="col-md-5">
            <div class="form-group form-group-lg">
                <label class="control-label">訂單編號</label>
                <div class="has-success">
                    <input type="text" class="form-control" name="orderID" data-bind="value: orderID">
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group form-group-lg">
                <label class="control-label">訂單日期</label>
                <div class="has-success">
                    <input type="date" class="form-control" name="orderdate" required>
                </div>
            </div>
        </div>
    </div>
    
<table class="table table-condensed">
    <thead class="text-uppercase">
        <tr>
        <th>標籤品名</th>
        <th class="text-center">價格</th>
        <th class="text-center">數量</th>
        <th class="text-center">總價值</th>
        <th>備註</th>
    </tr></thead>
    <tbody data-bind="foreach: rows">
        <tr>            
<!--        Product label    -->
            <input type="hidden" name="MPN" data-bind="value: MPN">
            <input type="hidden" name="is_supply" data-bind="value: is_supply">
            <td style="width: 15%">
                <span class="text-left" data-bind="text: label"></span>
            </td>
            
<!--        Price    -->
            <td style="width:20%">
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-right" name="price" data-bind="textInput: price" required />
                    <div class="input-group-addon" data-bind="text: pricing"></div>
                </div>
            </td>
            
<!--        Quantities    -->
            <td style="width:15%">
                <div class="input-group has-success">
                <input style="font-size: 18px;" type="number" min=1 max=100000 class="form-control text-right" name="qty" data-bind="textInput: qty" required />
                <div class="input-group-addon" data-bind="text: jianshu"></div>
                </div>
            </td>
            
<!--        Total value    -->
            <td style="width:15%">
                <div class="input-group has-success">
                    <div class="input-group-addon">$</div>
                    <input disabled style="font-size: 18px;" type="number" min=1 step="0.001" class="form-control text-left total-value" data-bind="value: total_value">
                </div>
            </td>
                        
<!--        Notes    -->
            <td style="width:20%">
                <input type="text" style="width: 100%" class="form-control" name="ordernote">
            </td>
            
        </tr>
        </tbody>
</table>
        
    <div class="row">
        <div class="col-md-4 col-md-offset-1">
            
            <input type="hidden" name="back" value="/product/show/<%= cogroup.name %>">
            <input type="submit" class="btn btn-lg btn-success" name="make_po" value="創造訂單">
            
        </div>
        
        <div class="col-md-5 form-group form-group-lg form-inline">
            <label class="control-label">訂單總價</label>
            <div class="input-group has-success">
                <div class="input-group-addon">$</div>
                <input disabled style="font-size: 18px; width: 50%" type="text" class="form-control text-left" data-bind="value: grand_total()">
            </div>
        </div>
    </div>

    
    </div>
</div>
    
        
        
    


</div>


    
    
    
    
<script>
var cogroup = <%- JSON.stringify(cogroup) %>;
var co_name = '<%= cogroup.name %>';
var _csrf = '<%= _csrf %>';
    
function ItemsModel() {
    var self = this;
    
    self.orderID = ko.observable();
    
    self.products = ko.observableArray([]);
    self.productsGet = function () {
        params = {
            _csrf: _csrf, 
            id: co_name,
        };
        callback = function (products) {
            self.products.removeAll();
            for (var i=0; i<products.length; i++) {
                if (!products[i].discontinued) {
                    self.products.push(new KO_Product(products[i]));
                }
            }
        };
        getProducts(params, callback);
    };
    self.productsGet();
    
    self.rows = ko.observableArray([]);
    
    self.grand_total = ko.computed( function () {
        var total = 0;
        for (var i=0; i<self.rows().length; i++) {
            total += self.rows()[i].total_value();
        }
        return isNaN(total) ? '' : total;
    });
    
    for (var i=0; i<self.products.length; i=i+1) {
        self.rows.push(new KO_PurchaseOrder(self.products[i], self.orderID));
    }
    
    var selectCompute = ko.computed(function () {
        self.rows.removeAll()
        for (var i=0; i<self.products().length; i++) {
            if (self.products()[i].selected()) {
                self.rows.push(new KO_PurchaseOrder(ko.toJS(self.products()[i]), self.orderID));
            }
        }
    });
}

ko.applyBindings(new ItemsModel());

</script>